; Author: Guillem Alminyana
;
; A silly example on how to implement the execve for /bin/sh using Relative Addressing.
; Uses Rel Addressing to access to all the values required to setup the syscall
;
;
; Compile:
;	nasm -f elf64 file.nasm -o file.o
;	ld -N file.o -o file
; Test:
;	run ./file
;	connect from another terminal with nc localhost 4444
;

global _start

section .text

_start:

	jmp real_start

	command: db  "/bin//ls"
	nulo: db 0x00
	addr_command: dq 0x00

real_start:
	
	; RDI <- @command
	lea rdi, [rel command]

	; RSI <- @ ADDR command
	mov rax, [rdi]
	mov [addr_command], rax

	lea rsi, [rel addr_command]

	; RDX <- nulo
	lea rdx, [rel nulo]

  ; Syscall Number
	push 59
  pop rax
	syscall



